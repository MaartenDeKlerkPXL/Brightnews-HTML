<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wachtwoord Instellen âœ¨ Bright News</title>
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/pages/profiel.css">
    <script src="index.js"></script>
    <script src="js/translations.js"></script>
</head>
<body>
<header>
    <nav class="container">
        <div class="nav-left-group">
            <div class="dropdown language-picker">
                <button class="dropbtn" id="current-lang">
                    ğŸ‡ºğŸ‡¸ English <span class="arrow">â–¼</span>
                </button>
                <div class="dropdown-content">
                    <a href="#" onclick="wisselTaal('en', 'ğŸ‡ºğŸ‡¸ English', event)">ğŸ‡ºğŸ‡¸ English</a>
                    <a href="#" onclick="wisselTaal('nl', 'ğŸ‡³ğŸ‡± Nederlands', event)">ğŸ‡³ğŸ‡± Nederlands</a>
                    <a href="#" onclick="wisselTaal('de', 'ğŸ‡©ğŸ‡ª Deutsch', event)">ğŸ‡©ğŸ‡ª Deutsch</a>
                    <a href="#" onclick="wisselTaal('fr', 'ğŸ‡«ğŸ‡· FranÃ§ais', event)">ğŸ‡«ğŸ‡· FranÃ§ais</a>
                    <a href="#" onclick="wisselTaal('es', 'ğŸ‡ªğŸ‡¸ EspaÃ±ol', event)">ğŸ‡ªğŸ‡¸ EspaÃ±ol</a>
                </div>
            </div>

            <a href="index.html" class="logo">Bright<span>News</span></a>
        </div>
        <button class="hamburger" onclick="toggleMobileMenu()" aria-label="Menu openen">
            <span></span><span></span><span></span>
        </button>
        <ul class="nav-links" id="mobileMenu">
            <li><a href="index.html" data-i18n="nav_home">Home</a></li>
            <li><a href="over-ons.html" data-i18n="nav_about">Over Ons</a></li>
            <li><a href="abonnementen.html" data-i18n="nav_premium">Abonnementen</a></li>

            <li class="nav-profile-desktop">
                <a href="profiel.html" class="profile-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                </a>
            </li>

            <li class="nav-profile-mobile">
                <a href="profiel.html" class="profile-link-text"  data-i18n="nav_profile">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    Profiel
                </a>
            </li>
        </ul>

    </nav>
</header>

<main class="auth-page-container">
    <div class="auth-box auth-box-centered">
        <div class="form-container">
            <div class="auth-header">
                <h2 data-i18n="reset_title">Nieuw wachtwoord ğŸ”</h2>
                <p data-i18n="reset_subtitle">Kies een sterk wachtwoord dat je goed kunt onthouden.</p>
            </div>

            <form onsubmit="updatePassword(event)">
                <div class="input-group">
                    <label data-i18n="label_new_password">Nieuw Wachtwoord</label>
                    <div class="password-wrapper">
                        <input type="password" id="new-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                        <span class="toggle-password" onclick="togglePassword(event, 'new-password')">ğŸ‘ï¸</span>
                    </div>
                </div>
                <button type="submit" class="btn-primary-editorial" data-i18n="btn_save_password">Wachtwoord Opslaan</button>
            </form>
        </div>
    </div>
</main>

<div id="notification-container"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    const SUPABASE_URL = 'https://rquuqypgaannrakdrabj.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJxdXVxeXBnYWFubnJha2RyYWJqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MTQyODUsImV4cCI6MjA4NjM5MDI4NX0.-H5ZIcLXBflqKvC0VQGlVGIX29G-nceC9ak5IrhJCzg';
    window.supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    function showNotification(message, type = 'success') {
        const container = document.getElementById('notification-container');
        const n = document.createElement('div');
        n.className = `notification ${type}`;
        n.innerText = (type === 'success' ? 'âœ… ' : 'âŒ ') + message;
        container.appendChild(n);
        setTimeout(() => n.classList.add('show'), 10);
        setTimeout(() => { n.classList.remove('show'); setTimeout(() => n.remove(), 500); }, 4000);
    }

    function togglePassword(event, id) {
        const input = document.getElementById(id);
        input.type = input.type === 'password' ? 'text' : 'password';
        event.target.innerText = input.type === 'password' ? 'ğŸ‘ï¸' : 'ğŸ™ˆ';
    }

    async function updatePassword(event) {
        event.preventDefault();
        const newPassword = document.getElementById('new-password').value;

        const { error } = await window.supabaseClient.auth.updateUser({
            password: newPassword
        });

        if (error) {
            showNotification("Fout: " + error.message, "error");
        } else {
            showNotification("Wachtwoord succesvol gewijzigd! Je wordt doorgestuurd...", "success");
            setTimeout(() => window.location.href = 'profiel.html', 2000);
        }
    }
</script>
</body>
</html>